"use strict";function transformSchArr(a){for(var b=[],c=0,d=a.length;c<d;c++){var e={id:a[c].school_id,name:a[c].school_name};b.push(e)}return b}function getCurrentDate(){var a=new Date,b=a.getFullYear(),c=a.getMonth()+1,d=a.getDate();return b+"-"+c+"-"+d}function isDate(a){var b=a.match(/((^((1[8-9]\d{2})|([2-9]\d{3}))(-)(10|12|0?[13578])(-)(3[01]|[12][0-9]|0?[1-9])$)|(^((1[8-9]\d{2})|([2-9]\d{3}))(-)(11|0?[469])(-)(30|[12][0-9]|0?[1-9])$)|(^((1[8-9]\d{2})|([2-9]\d{3}))(-)(0?2)(-)(2[0-8]|1[0-9]|0?[1-9])$)|(^([2468][048]00)(-)(0?2)(-)(29)$)|(^([3579][26]00)(-)(0?2)(-)(29)$)|(^([1][89][0][48])(-)(0?2)(-)(29)$)|(^([2-9][0-9][0][48])(-)(0?2)(-)(29)$)|(^([1][89][2468][048])(-)(0?2)(-)(29)$)|(^([2-9][0-9][2468][048])(-)(0?2)(-)(29)$)|(^([1][89][13579][26])(-)(0?2)(-)(29)$)|(^([2-9][0-9][13579][26])(-)(0?2)(-)(29)$))/);return null!=b}function isTime(a){console.log(a);var b=a.match(/^(\d{1,2})(:)?(\d{1,2})$/);return null!=b&&(!!b[2]&&!(b[1]>24||b[3]>60))}function ajaxFileUpload(a,b){$.ajaxFileUpload({url:b,secureuri:!1,fileElementId:a,dataType:"json",success:function(a,b){console.log(a),console.log(b)},error:function(a,b,c){alert(c)}})}function callbackAlert(a,b){1==a?b?alert(b):alert("操作成功"):2==a?alert("没有权限!"):alert("系统错误，请稍后重试!")}function getDataFromStorage(a){var b=localStorage.getItem(a);return b=JSON.parse(b)}var ROOT="http://120.25.229.249:8000/app/#/",app=angular.module("homeApp",["ngRoute","ngCookies","tm.pagination","publicService","homeApp.home","homeApp.operating","homeApp.student","homeApp.educate","homeApp.finance","homeApp.analysis"]).config(function(a){a.when("/:user_id",{templateUrl:"views/home/calendar.html",controller:"calendar"})}).controller("homeApp",function(a,b){a.user={id:b.get("user_id")},a.birthday=0,a.$on("changeBirth",function(b){a.birthday=b}),a.$on("putCookie",function(b){a.user.id=b})}).controller("homeApp.header",function(a,b,c){a.underline=function(a){$("#nav").children().removeClass("active-li"),$("#nav").children().eq(a).addClass("active-li")},a.logOut=function(){c("",function(a){b.remove("authority"),b.remove("user_name"),b.remove("sch_name"),b.remove("user_id"),b.remove("sch_id"),b.remove("type"),callbackAlert(a.status,"已退出登录"),1==a.status&&(window.location.href=ROOT+"login")})}}).controller("login",function(a,b,c,d,e,f,g){a.user={user_id:"",user_pwd:""},a.login=function(b){if(b){var c=a.user.user_pwd,e={user_id:a.user.user_id,user_pwd:$.md5(c)};console.log(e),d(e,h)}else alert("请完善登录信息")};var h=function(d){var h=d.status;1==h?(c.put("authority",d.authority),c.put("user_name",d.user_name),c.put("sch_name",d.sch_name),c.put("user_id",d.user_id),c.put("sch_id",d.sch_id),c.put("type",d.type),a.$emit("putCookie",d.user_id),g("",function(b){a.$emit("changeBirth",b.status)}),e("",function(d){localStorage.setItem("options",JSON.stringify(d)),a.$apply(function(){b.path("/"+c.get("user_id"))})}),f("",function(a){localStorage.setItem("courses",JSON.stringify(a))})):alert("用户名或密码错误")}}),ROOT="http://whyville.cn/app/#",API="http://120.25.229.249:8001/get_img",num_per_page=12,postData=function(a,b,c){$.ajax({url:a,method:"POST",data:b,dataType:"json",beforeSend:function(){$(".mask").show()},xhrFields:{withCredentials:!0},success:function(a){c(a)},complete:function(){$(".mask").hide()}})},getData=function(a,b,c){$.ajax({url:a,method:"GET",data:c,dataType:"json",beforeSend:function(){$(".mask").show()},xhrFields:{withCredentials:!0},success:function(a){b(a)},complete:function(){$(".mask").hide()}})},checkInputInObj=function(a){var b=1;for(var c in a)if(!a[c]){b=0;break}return b};angular.module("homeApp").directive("selectItem",function(){return{restrict:"EA",scope:{selectOptions:"=selectOptions",item:"=whichItem",sendFilter:"&"},templateUrl:"./views/public/select-item.html",link:function(a,b,c){a.options={show:!1},a.toggleOptions=function(){a.options.show=!a.options.show},a.clickOptions=function(){var b=this.item;a.options.show=!1,a.item.name=b,a.sendFilter()}}}}).directive("selectNoId",function(){return{restrict:"EA",scope:{selectOptions:"=selectOptions",item:"=whichItem",sendFilter:"&"},templateUrl:"./views/public/select-item-2.html",link:function(a,b,c){a.options={show:!1},a.toggleOptions=function(){a.options.show=!a.options.show},a.clickOptions=function(){var b=this.item;a.options.show=!1,a.item=b,a.sendFilter()}}}}).controller("mySelect",function(a){a.options={show:!1},a.toggleOptions=function(){a.options.show=!a.options.show,a.downClick()},a.clickOptions=function(){var b=this.item.name,c=this.item.id;a.options.show=!1,a.selected.name=b,a.selected.id=c,console.log(a),a.sendFilter()}}).directive("teachAttend",function(){return{restrict:"EA",scope:{selectOptions:"=selectOptions",selected:"=whichItem",sendFilter:"&",iconShow:"=iconShow"},template:'<div class="select-container"><div class="options"><div class="content-wrap" ng-bind="selected.name | hasNotFinished"></div><ul class="options-ul" ng-show="options.show"><li ng-repeat="item in selectOptions" ng-click="clickOptions()">{{item.name}}</li></ul></div><i class="click-show-btn down-btn-{{options.show}}" ng-show="iconShow" ng-init="options.show = false" ng-click="toggleOptions()"></i></div>',controller:"mySelect"}}).directive("mySelect",function(){return{restrict:"EA",scope:{selectOptions:"=selectOptions",selected:"=whichSchool",sendFilter:"&",downClick:"&"},template:'<div class="select-container"><div class="options"><div class="content-wrap" ng-bind="selected.name | chooseForNone"></div><ul class="options-ul" ng-show="options.show"><li ng-repeat="item in selectOptions" ng-click="clickOptions()">{{item.name}}</li></ul></div><i class="click-show-btn down-btn-{{options.show}}" ng-init="options.show = false" ng-click="toggleOptions()"></i></div>',controller:"mySelect"}}).controller("radio",function(a,b){b.on("click"," .radio-btn",function(){var c=$(this).data("code");a.radioVal=c,a.$apply(),$(" .radio-btn",b).removeClass("radio-true"),$(this).addClass("radio-true")})}).directive("myRadio",function(){return{restrict:"EA",scope:{radioVal:"=radioValue",options:"=options"},templateUrl:"./views/public/radio.html",controller:"radio"}}).directive("mySelectAttend",function(){return{restrict:"EA",scope:{selectOptions:"=selectOptions",selected:"=whichSchool",sendFilter:"&",iconShow:"=iconShow"},template:'<div class="select-container"><div class="options"><div class="content-wrap" ng-bind="selected.name | chooseForNone"></div><ul class="options-ul" ng-show="options.show"><li ng-repeat="item in selectOptions" ng-click="clickOptions()">{{item.name}}</li></ul></div><i class="click-show-btn down-btn-{{options.show}}" ng-show="iconShow" ng-init="options.show = false" ng-click="toggleOptions()"></i></div>',controller:"mySelect"}}).directive("linkSelect",function(){return{restrict:"EA",scope:{selectOptions:"=selectOptions",selectedOne:"=firstOne",selectedTwo:"=secondOne",sendFilter:"&"},template:'<div class="select-container link-select"><div class="options"><div class="content-wrap" ng-bind="selectedOne.name | chooseForNone"></div><ul class="options-ul" ng-show="options.showFirst"><li ng-repeat="item in selectOptions[0]" ng-click="clickFirstOptions($index)">{{item.name}}</li></ul></div><i class="click-show-btn down-btn-{{options.showFirst}}" ng-init="options.showFirst = false" ng-click="toggleFirst()"></i></div><i class="to-icon-select"></i><div class="select-container"><div class="options"><div class="content-wrap" ng-bind="selectedTwo.name | chooseForNone"></div><ul class="options-ul" ng-show="options.showSecond"><li ng-repeat="item in secondOptions" ng-click="clickSecondOptions()">{{item.name}}</li></ul></div><i class="click-show-btn down-btn-{{options.showSecond}}" ng-init="options.showSecond = false" ng-click="toggleSecond()"></i></div>',link:function(a){a.toggleFirst=function(){a.options.showFirst=!a.options.showFirst},a.toggleSecond=function(){a.options.showSecond=!a.options.showSecond},a.clickFirstOptions=function(b){var c=this.item.name,d=this.item.id;a.selectedTwo={id:"",name:""},a.secondOptions=a.selectOptions[b+1],a.options.showFirst=!1,a.selectedOne.name=c,a.selectedOne.id=d,a.sendFilter()},a.clickSecondOptions=function(){var b=this.item.name,c=this.item.id;a.options.showSecond=!1,a.selectedTwo.name=b,a.selectedTwo.id=c,a.sendFilter()}}}}).directive("myCount",function(){return{restrict:"EA",scope:{timeNum:"=howMany"},template:'<i class="count-icon left-minus" ng-click="addTimes(-1)"></i><span class="times-wrap">{{timeNum}}</span><i class="count-icon right-add" ng-click="addTimes(1)"></i>',link:function(a){a.addTimes=function(b){(b==-1&&a.timeNum>0||1==b)&&(a.timeNum=parseInt(a.timeNum)+parseInt(b))}}}}).directive("dateSelect",function(){return{restrict:"EA",scope:{date:"=whichDate",sendFilter:"&"},templateUrl:"./views/public/select-date.html",link:function(a,b,c){for(var d=new Date,e=d.getFullYear(),f=[],g=[],h=5;h<30;h++)f.push(e-h);for(var h=1;h<=31;h++)g.push(h);a.Year=f,a.Month=["1","2","3","4","5","6","7","8","9","10","11","12"],a.Day=g,$(b).on("click",".click-show-btn",function(){var a=$(this).siblings(".options").children(".options-ul");$(this).hasClass("down-btn-true")?($(this).removeClass("down-btn-true"),a.hide()):($(this).addClass("down-btn-true"),a.show())}),$(b).on("click",".options-ul li",function(){var c=$(this).data("type"),d=$(this).html();"year"==c?a.date.year=d:"month"==c?a.date.month=d:a.date.day=d,a.sendFilter(),$(this).parent().siblings(".content-wrap").html(d),$(".options-ul",b).hide(),$(".click-show-btn").removeClass("down-btn-true"),a.$apply()})}}}).directive("chooseSex",function(){return{restrict:"A",scope:{radioVal:"=radioValue",options:"=options"},template:'    <div>      <span><i class="radio-btn" ng-class="{&quot;radio-true&quot;: radioVal == 0}" data-code="0"></i>男</span>      <span><i class="radio-btn" ng-class="{&quot;radio-true&quot;: radioVal == 1}" data-code="1"></i>女</span></div>',link:function(a,b){b.on("click"," .radio-btn",function(){var c=$(this).data("code");a.radioVal=c,a.$apply(),$(" .radio-btn",b).removeClass("radio-true"),$(this).addClass("radio-true")})}}}).directive("sidebar",function(){return{restrict:"EA",scope:{itemName:"=",itemLink:"="},template:'<a href="javascript:void(0);">{{itemName}}</a>',link:function(a,b){b.on("click",function(){b.siblings().removeClass("active-tab"),$(this).addClass("active-tab"),$("html, body").animate({scrollTop:$(a.itemLink).offset().top},500)})}}}).directive("validTime",[function(){return{require:"ngModel",link:function(a,b,c,d){var e=function(a){var b=d.$isEmpty(a)||isTime(a);return d.$setValidity("timeFormat",b),b?a:void 0};d.$formatters.push(e),d.$parsers.push(e)}}}]),angular.module("homeApp").filter("chooseForNone",function(){return function(a){return a?a:"未选择"}}).filter("countAge",function(){return function(a){var b=(new Date).getFullYear();return b-a}}).filter("hasNotFinished",function(){return function(a){return a?a:"未填写"}}).filter("editing",function(){return function(a,b){return b?"完成":a}}).filter("busType",function(){return function(a){return"1"==a?"接":"送"}}).filter("checkEnter",function(){return function(a){return"1"==a?"已录入":"未录入"}}).filter("checkAttend",function(){return function(a){return 1==a?"已填写":"未填写"}}).filter("sex",function(){return function(a){return"1"==a?"女":"男"}}).filter("feeOrNot",function(){return function(a){return"1"==a?"已付款":"未付款"}}).filter("yesOrNo",function(){return function(a){return a?"是":"否"}}).filter("learningStatus",function(){return function(a){var b=["报名","试听","入学","暂停","退学"];return b[a-1]}}).filter("numberToWeek",function(){return function(a){var b=["星期一","星期二","星期三","星期四","星期五","星期六","星期天"];return b[a-1]}}).filter("pay_or_not",function(){return function(a){if(0==a)return"未付款"}}).filter("accept_or_not",function(){return function(a){return 1==a?"通过":"不通过"}}).filter("teacher_type",function(){return function(a){return a?"兼职老师":"全职老师"}}).filter("NaNtoO",function(){return function(a){return isNaN(a)?0:a}}),angular.module("publicService",[]).factory("server",function(){return"http://120.25.229.249:8001/"}).factory("injectOperating",function(a,b){return{inject:function(){console.log("inject");var b=a.defer(),c=function(){$.getScript("./js/min-controller/operating.js",function(){b.resolve()})};return c(),b.promise}}}).factory("API",function(a){return{fetchAllJobs:a+"jobs",uploadPhoto:a+"upload_img",fetchSchCourseType:a+"get_schools_coursetype",fetchOptions:a+"common_data",fetchCourseByStu:a+"get_sch_by_stu",getStuName:a+"get_student_name",logOut:a+"logout",birthAlert:a+"birthday_alert"}}).factory("birthAlert",function(a){return function(b,c){getData(a.birthAlert,c,b)}}).factory("logOut",function(a){return function(b,c){getData(a.logOut,c,b)}}).factory("getStuName",function(a){return function(b,c){getData(a.getStuName,c,b)}}).factory("fetchCourseByStu",function(a){return function(b,c){getData(a.fetchCourseByStu,c,b)}}).factory("fetchOptions",function(a){return function(b,c){getData(a.fetchOptions,c,b)}}).factory("getWeekDays",function(){return[{id:"1",name:"星期一"},{id:"2",name:"星期二"},{id:"3",name:"星期三"},{id:"4",name:"星期四"},{id:"5",name:"星期五"},{id:"6",name:"星期六"},{id:"7",name:"星期日"}]}).factory("getYearMonth",function(){var a,b=[];for(a=0;a>=-10;a--){var c=moment().add(a,"months").format("YYYY-MM");b.push(c)}return b}).factory("previewImage",function(a){return function(a){$(".upload-btn input").on("change",function(){var b=$(this),c=$(this).val(),d=c.substr(c.indexOf(".")),e=new FileReader;e.readAsDataURL(this.files[0]);var f=new Image,g=b.parent();g.hide();g.siblings(".upload-img");e.onload=function(){f.src=this.result,f.onload=function(){g.siblings(".upload-img").html(f)}},a(d)})}}).factory("uploadPhoto",function(a){return function(b,c,d,e){b.submit(function(){return b.ajaxSubmit({type:"post",url:a.uploadPhoto,data:{id:c,ext_name:d},xhrFields:{withCredentials:!0},success:function(a){e(a)}}),!1}),b.submit()}}).factory("getYears",function(){for(var a=new Date,b=a.getFullYear(),c=[],d=0;d<5;d++)c.push(b-d);return c}).factory("getYearSessions",function(){for(var a=new Date,b=a.getFullYear(),c=[],d=-1;d<5;d++)c.push(b-d);return{year:c,session:["春季班","夏季班","秋季班","冬季班"],sessions:[{id:0,name:"全部季度"},{id:1,name:"春季班"},{id:2,name:"夏季班"},{id:3,name:"秋季班"},{id:4,name:"冬季班"}]}}).factory("getDate",function(){for(var a=[],b=0;b>=-10;b--){var c=moment().add(b,"day").format("YYYY-MM-DD");a.push(c)}return a}).factory("pagination",function(){return function(a){return{currentPage:1,totalItems:a,itemsPerPage:num_per_page,pagesLength:15,perPageOptions:[10,20,30,40,50]}}}).factory("fetchAllJobs",function(a){return function(b,c){getData(a.fetchAllJobs,c,b)}}),angular.module("homeApp.home",["ngRoute","homeApp.homeService"]).config(function(a){a.when("/addNotice",{templateUrl:"views/home/editNotice.html",controller:"addNotice"}).when("/addSchedule",{templateUrl:"views/home/editSchedule.html",controller:"addSchedule"}).when("/modifyNotice/:ntc_id",{templateUrl:"views/home/editNotice.html",controller:"modifyNotice"}).when("/modifySche/:ntc_id",{templateUrl:"views/home/editSchedule.html",controller:"modifySchedule"}).when("/notice/:ntc_id",{templateUrl:"views/home/notice.html",controller:"notice"}).when("/applications",{templateUrl:"views/home/applications.html",controller:"applications"}).when("/applyfor",{templateUrl:"views/home/applyfor.html",controller:"applyfor"}).when("/acceptApp/:app_id",{templateUrl:"views/home/acceptApp.html",controller:"acceptApp"}).when("/modifyApp/:app_id",{templateUrl:"views/home/modApp.html",controller:"modifyApp"}).when("/login",{templateUrl:"views/home/login.html",controller:"login"}).when("/modifyPwd",{templateUrl:"views/public/modifyPwd.html",controller:"modifyPwd"})}),angular.module("homeApp.homeService",[]).factory("homeAPI",function(a){return{login:a+"login",submitNotice:a+"add_notice",submitSche:a+"add_schedule",fetchHomeInfo:a+"get_notice_schedule",clickDate:a+"get_notice_schedule",addApp:a+"add_application",fetchApps:a+"get_application",modifyApp:a+"change_application",acceptApp:a+"change_application_status",fetchNoticeById:a+"get_notice",modifyNotice:a+"change_notice",deleteNotice:a+"delete_notice",fetchScheById:a+"get_schedule",modifySche:a+"change_schedule",deleteSche:a+"delete_schedule",modifyPwd:a+"reset_own_password"}}).factory("clickDate",function(a){return function(b,c){getData(a.clickDate,c,b)}}).factory("addNoticeFormInit",function(){var a=new Date,b=a.getFullYear(),c=a.getMonth()+1,d=a.getDate();return{ntc_title:"",ntc_sch:{id:1,name:"全部校区"},ntc_start:{year:b,month:c,day:d},ntc_end:{year:b,month:c,day:d},ntc_content:""}}).factory("addScheFormInit",function(){var a=new Date,b=a.getFullYear(),c=a.getMonth()+1,d=a.getDate();return{ntc_title:"",ntc_sch:{id:1,name:"全部校区"},ntc_start:{year:b,month:c,day:d},ntc_end:{year:b,month:c,day:d}}}).factory("fetchNoticeById",function(a){return function(b,c){getData(a.fetchNoticeById,c,b)}}).factory("modifyNotice",function(a){return function(b,c){postData(a.modifyNotice,b,c)}}).factory("deleteNotice",function(a){return function(b,c){getData(a.deleteNotice,c,b)}}).factory("fetchScheById",function(a){return function(b,c){getData(a.fetchScheById,c,b)}}).factory("modifySche",function(a){return function(b,c){postData(a.modifySche,b,c)}}).factory("deleteSche",function(a){return function(b,c){getData(a.deleteSche,c,b)}}).factory("initHome",function(a){}).factory("fetchNtc",function(a,b){var c=function(a){return console.log(a),{ntc_title:"春节放假通知",startDate:"2016-04-04",endDate:"2016-04-16",ntc_sch:"大学城校区",ntc_content:" #魅蓝手机3# 正式发布 599 元起，「颜值加速度」 2.5D 多彩聚碳酸酯，5 英寸八核全网通！25 日 16:00 魅族商城、专卖店、天猫旗舰店，苏宁易购等渠道开始预约，29 日魅族商城、天猫旗舰店，苏宁易购同步首发！专卖店及各零售卖场将陆续开售。 L参与预约，百台魅蓝3任性送#魅蓝手机3# 正式发布 599 元起，「颜值加速度」 2.5D 多彩聚碳酸酯，5 英寸八核全网通！",emp_name:"罗晓彤",ntc_time:"2014-04-02"}};return{fetchNtc:function(a){return c(a)}}}).factory("fetchApp",function(a,b){}).factory("initAppForm",function(a,b,c){new Date;return{user:{emp_id:c.get("user_id"),date:getCurrentDate(),emp_sch:c.get("sch_name"),emp_name:c.get("user_name"),app_title:""},app:[{app_content:"",app_per:"",app_num:""}]}}).factory("fetchApplyById",function(a){return function(b,c){getData(a.fetchApps,c,b)}}).factory("login",function(a,b,c){return function(a,c){postData(b.login,a,c)}}).factory("submitNotice",function(a){return function(b,c){postData(a.submitNotice,b,c)}}).factory("submitSche",function(a){return function(b,c){console.log(a),postData(a.submitSche,b,c)}}).factory("fetchHomeInfo",function(a){return function(b,c){getData(a.fetchHomeInfo,c,b)}}).factory("fetchHomeByYearM",function(a){return function(b,c){getData(a.clickDate,c,b)}}).factory("addApp",function(a){return function(b,c){postData(a.addApp,b,c)}}).factory("fetchApps",function(a){return function(b,c){console.log(b),getData(a.fetchApps,c,b)}}).factory("modifyApp",function(a){return function(b,c){postData(a.modifyApp,b,c)}}).factory("acceptApp",function(a){return function(b,c){postData(a.acceptApp,b,c)}}).factory("modifyPwd",function(a){return function(b,c){getData(a.modifyPwd,c,b)}}),angular.module("homeApp.home").controller("modifyPwd",function(a,b,c,d){a.postData={new_pwd:"",re_pwd:""},a.modifyPwd=function(e){if(e){var f=a.postData;if(!f.new_pwd)return alert("密码不能为空"),!1;if(f.new_pwd!==f.re_pwd)return console.log(a.postData),alert("两次密码不一致"),!1;var g={new_pwd:$.md5(a.postData.new_pwd),re_pwd:$.md5(a.postData.re_pwd)};d(g,function(d){1==d.status&&(alert("成功修改密码"),a.$apply(function(){b.path("/"+c.get("user_id"))}))})}}}),angular.module("homeApp.home").controller("applications",function(a,b,c,d,e){var f={type:b.get("type"),user_id:b.get("user_id")};3!=f.type&&4!=f.type||(alert("没有访问权限"),c.path("/"+f.user_id)),a.emp_type={authority:b.get("authority")},console.log(a.emp_type),a.filter={selectSchool:{id:1,name:"全部校区"},type:{id:0,name:"全部申请表"},page:1,num:num_per_page};var g=localStorage.getItem("options");g=JSON.parse(g),a.options={schools:g.schools,app_status:[{id:"0",name:"全部申请表"},{id:"1",name:"已审核申请表"},{id:"2",name:"待审核申请表"}]},a.paginationConf={};var h=function(){d(a.filter,function(b){console.log(b),a.applicate=b.result;var c=b.sum;a.paginationConf=e(c),a.paginationConf.onChange=function(){a.filter.page=a.paginationConf.currentPage,a.pageChange()},a.$apply()})};h(),a.accept=function(b,d){return 0==a.emp_type.authority&&void c.path("/acceptApp/"+b).search({status:d})},a.modify=function(a,b){return 0!=a&&void c.path("/modifyApp/"+b)},a.pageChange=function(){d(a.filter,function(b){a.applicate=b.result,a.$apply()})},a.sendFilter=function(){a.filter.page=1,h()}}).controller("applyfor",function(a,b,c,d,e){var f={type:b.get("type"),user_id:b.get("user_id")};3==f.type||4==f.type?(alert("没有访问权限"),c.path("/"+f.user_id)):(a.appForm=d,a.addItem=function(){var b={app_content:"",app_per:"",app_num:""};a.appForm.app.push(b),console.log(a.appForm)},a.total={total_price:0},a.countTotal=function(){a.total.total_price=0;var b=a.total.total_price;isNaN(b)&&(a.total.total_price=0);for(var c=0,d=a.appForm.app.length;c<d;c++)a.total.total_price+=a.appForm.app[c].app_per*a.appForm.app[c].app_num},a.submitApp=function(){console.log(a.appForm),e(a.appForm,function(a){1==a.status&&(window.location.href=ROOT+"applications")})})}).controller("modifyApp",function(a,b,c,d,e){d(c,function(b){a.appForm=b,a.total_price=0;for(var c=0,d=a.appForm.app.length;c<d;c++)a.total_price+=a.appForm.app[c].app_per*a.appForm.app[c].app_num;a.$apply(),console.log(a.appForm)}),a.addItem=function(){var b={app_content:"",app_per:"",app_num:""};a.appForm.app.push(b),console.log(a.appForm)},a.countTotal=function(){isNaN(a.total_price)&&(a.total_price=0);for(var b=0,c=a.appForm.app.length;b<c;b++)a.total_price+=a.appForm.app[b].app_per*a.appForm.app[b].app_num},a.submitApp=function(){var b={app_id:c.app_id,app_title:a.appForm.user.app_title,app:a.appForm.app};e(b,function(a){callbackAlert(a.status,"修改成功"),window.location.href=ROOT+"applications"})}}).controller("acceptApp",function(a,b,c,d,e){d(c,function(b){a.appForm=b,a.$apply(),console.log(a.appForm)}),a.autoData={date:moment().format("YYYY-MM-DD"),sign_name:a.user.user_name},a.postData={app_id:c.app_id,status:b.search().status,opinion:""},a.acceptApp=function(){e(a.postData,function(a){callbackAlert(a.status,"审批成功"),1==a.status&&(window.location.href=ROOT+"applications")})}}),angular.module("homeApp.home").controller("calendar",function(a,b,c,d,e,f,g,h,i,j){d.search().s_id?a.filter={selectSchool:{id:d.search().s_id,name:d.search().s_na}}:a.filter={selectSchool:{id:c.get("sch_id"),name:c.get("sch_name")}};var k=localStorage.getItem("options");k=JSON.parse(k),a.options={schools:k.schools,cur_date:moment().format("YYYY-MM-DD")},g(a.filter,function(b){if(2==b.status)alert("没有权限查看");else{console.log(b),a.home1=b,a.home1.ntc_len=a.home1.notice.length,a.home1.sche_len=a.home1.schedule.length;a.home1.cur_mon_sche;n(b.cur_mon_sche),a.$apply()}});var l=moment().format("YYYY-MM"),m=0,n=function(b){moment.locale("zh-cn"),$(".cal1").clndr({events:b,clickEvents:{click:function(b){var c=b.date._i;a.filter.date=c,a.options.cur_date=c,f(a.filter,function(b){a.home1.notice=b,a.home1.ntc_len=b.length,a.$apply()});var d=b.events;a.home1.schedule=d,a.home1.sche_len=d.length},nextMonth:function(){m++,l=moment().add(m,"months").format("YYYY-MM"),o(l)},previousMonth:function(){m--,l=moment().add(m,"months").format("YYYY-MM"),o(l)}},multiDayEvents:{singleDay:"date",endDate:"endDate",startDate:"startDate"},showAdjacentMonths:!0,adjacentDaysChangeMonth:!1})},o=function(b){var c={selectSchool:a.filter.selectSchool,month:b};h(c,function(b){console.log(b);var c=b.cur_mon_sche;n(c),a.home1.cur_mon_ntc=b.cur_mon_ntc,a.$apply()})};a.emp_type={authority:c.get("authority"),type:c.get("type")},a.modifySche=function(a,b){return 0!=a&&void d.path("/modifySche/"+b)},a.deleteSche=function(b,c){if(0==b)return!1;var d={ntc_id:c};j(d,function(b){1==b.status?(alert("删除成功"),a.$apply(function(){window.location.reload()})):alert("出现错误")})},a.modifyNtc=function(a,b){return 0!=a&&void d.path("/modifyNotice/"+b)},a.deleteNtc=function(b,c){if(0==b)return!1;var d={ntc_id:c};i(d,function(b){1==b.status?(alert("删除成功"),a.$apply(function(){window.location.reload()})):alert("出现错误")})},a.sendFilter=function(){d.search({s_id:a.filter.selectSchool.id,s_na:a.filter.selectSchool.name})}}),angular.module("homeApp.home").controller("notice",function(a,b,c){c(b,function(b){console.log(b),a.notice=b,a.$apply()})}).controller("addNotice",function(a,b,c,d,e){a.formData=d;var f={authority:c.get("authority"),type:c.get("type")};if(0!=f.type&&1!=f.type&&2!=f.type)alert("没有权限访问"),b.path("/"+c.get("user_id"));else if(0!=f.authority&&1!=f.type)a.formData.ntc_sch={id:c.get("sch_id"),name:c.get("sch_name")};else{var g=localStorage.getItem("options");g=JSON.parse(g),a.options={schools:g.schools}}a.submitData=function(b){b?e(a.formData,function(a){callbackAlert(a.status,"添加成功"),a.status&&(window.location.href=ROOT+c.get("user_id"))}):alert("fail valid")}}).controller("modifyNotice",function(a,b,c,d,e,f){var g={authority:c.get("authority"),type:c.get("type")};if(0!=g.type&&1!=g.type&&2!=g.type)alert("没有权限访问"),b.path("/"+c.get("user_id"));else if(0!=g.authority&&1!=g.type);else{var h=localStorage.getItem("options");h=JSON.parse(h),a.options={schools:h.schools}}e(d,function(b){console.log(b),a.formData=b,a.$apply()}),a.submitData=function(){a.formData.ntc_id=d.ntc_id,f(a.formData,function(a){callbackAlert(a.status,"修改成功"),a.status&&(window.location.href=ROOT+c.get("user_id"))})}}).controller("addSchedule",function(a,b,c,d,e){a.formData=d;var f={authority:c.get("authority"),type:c.get("type")};if(0!=f.type&&1!=f.type&&2!=f.type)alert("没有权限访问"),b.path("/"+c.get("user_id"));else if(0!=f.authority&&1!=f.type)a.formData.ntc_sch={id:c.get("sch_id"),name:c.get("sch_name")};else{var g=localStorage.getItem("options");g=JSON.parse(g),a.options={schools:g.schools}}a.submitData=function(){console.log(a.formData),checkInputInObj(a.formData)&&(console.log(a.formData),e(a.formData,function(a){callbackAlert(a.status,"添加成功"),a.status&&(window.location.href=ROOT+c.get("user_id"))}))}}).controller("modifySchedule",function(a,b,c,d,e,f){var g={authority:c.get("authority"),type:c.get("type")};if(0!=g.type&&1!=g.type&&2!=g.type)alert("没有权限访问"),b.path("/"+c.get("user_id"));else if(0!=g.authority&&1!=g.type);else{var h=localStorage.getItem("options");h=JSON.parse(h),a.options={schools:h.schools}}e(d,function(b){a.formData=b,a.$apply()}),a.submitData=function(){a.formData.ntc_id=d.ntc_id,f(a.formData,function(a){callbackAlert(a.status,"修改成功"),a.status&&(window.location.href=ROOT+c.get("user_id"))})}}),angular.module("homeApp.operating",["ngRoute","homeApp.operatingService"]).config(function(a){a.when("/employees",{templateUrl:"views/operating/employees.html",controller:"employees"}).when("/addEmp/:emp_id",{templateUrl:"views/operating/addEmp.html",controller:"addEmp"}).when("/modifyEmp/:emp_id",{templateUrl:"views/operating/modifyEmp.html",controller:"modifyEmp"}).when("/empInfo/:emp_id",{templateUrl:"views/operating/employeeInfo.html",controller:"empInfo"}).when("/schoolManage",{templateUrl:"views/operating/schoolManage.html",controller:"SchoolManage"}).when("/addSchool",{templateUrl:"views/operating/addSchool.html",controller:"AddSchool"}).when("/modifySchool/:sch_id",{templateUrl:"views/operating/modifySchool.html",controller:"modifySchool"}).when("/emp_birth",{templateUrl:"views/operating/emp_birthday.html",controller:"empBirth"})}),angular.module("homeApp.operatingService",[]).factory("operateAPI",function(a){return{employeeInfo:"EmployeeInfo",employees:a+"employee_information",deleteEmp:a+"dismiss_employee",resetPwd:a+"reset_imployee_password",createId:a+"get_employee_new_id",fetchInfoById:a+"",fetchSchById:a+"school",submitEmpInfo:a+"add_employee",modifyComment:a+"change_employee_other_information",fetchAllSchools:a+"school",addSchool:a+"add_school",modifySchInfo:a+"change_school_information",fetchEmpById:a+"change_employee_information"}}).factory("employees",function(a){return function(b,c){getData(a.employees,c,b)}}).factory("deleteEmp",function(a,b){return function(a,c){getData(b.deleteEmp,c,a)}}).factory("resetPwd",function(a){return function(b,c){getData(a.resetPwd,c,b)}}).factory("createId",function(a,b){return function(a,c){getData(b.createId,c)}}).factory("fetchInfoById",function(a){return function(b,c){getData(a.fetchInfoById,c,b)}}).factory("fetchSchById",function(a){return function(b,c){getData(a.fetchSchById,c,b)}}).factory("submitEmpInfo",function(a,b){return function(a,c){$("#empForm").ajaxSubmit({type:"post",url:b.submitEmpInfo,dataType:"json",data:a,xhrFields:{withCredentials:!0},beforeSend:function(){$(".mask").show()},success:function(a){c(a)},complete:function(){$(".mask").hide()},error:function(a){alert("文件上传失败")}})}}).factory("initEmpForm",function(){return function(a){return{emp_id:a,emp_name:"",emp_pic:{ext_name:""},emp_birth:{year:moment().format("YYYY"),month:moment().format("MM"),day:moment().format("DD")},emp_sex:0,emp_card:"",emp_tel:"",emp_email:"",emp_urgent:"",emp_sch:{id:"",name:""},emp_job:{id:"0",name:"未选择"},start_date:{year:moment().format("YYYY"),month:moment().format("MM"),day:moment().format("DD")},emp_salary:"",first_comment:""}}}).factory("modifyComment",function(a){return function(b,c){postData(a.modifyComment,b,c)}}).factory("fetchAllSchools",function(a){return function(b,c){getData(a.fetchAllSchools,c,b)}}).factory("addSchool",function(a){return function(b,c){postData(a.addSchool,b,c)}}).factory("modifySchInfo",function(a){return function(b,c){postData(a.modifySchInfo,b,c)}}).factory("fetchEmpById",function(a){return function(b,c){getData(a.fetchEmpById,c,b)}}).factory("modifyEmp",function(a){return function(b,c){postData(a.fetchEmpById,b,c)}}),angular.module("homeApp.operating").controller("addEmp",function(a,b,c,d,e,f,g){var h=getDataFromStorage("options");a.options={schools:h.schools,jobs:h.jobs},a.employeeInfo=e(c.emp_id),g(function(b){a.employeeInfo.emp_pic.ext_name=b,a.$apply()}),a.submitInfo=function(c){if(c){var e=a.employeeInfo;e.emp_sch.id&&e.emp_job.id?f(e,function(c){1==c.status?(alert("添加成功"),d("",function(a){localStorage.setItem("options",JSON.stringify(a))}),a.$apply(function(){b.path("/employees")})):alert("出现错误，稍后重试")}):alert("请检查是否有必须项未填")}}}).controller("modifyEmp",function(a,b,c,d,e,f){a.sidebar=[{name:"基本信息",link:"#basic","default":1},{name:"员工评价",link:"#comment"}];var g=getDataFromStorage("options");a.options={schools:g.schools,jobs:g.jobs},d(c,function(b){console.log(b),a.employeeInfo=b;var c=API+b.info.emp_pic;a.employeeInfo.info.emp_pic=c,a.$apply()}),a.modifyEmp=function(){console.log(a.employeeInfo.info),e(a.employeeInfo.info,function(c){callbackAlert(c.status,"修改成功"),1==c.status&&a.$apply(function(){b.path("/employees")})})},a.submitCom=function(){a.employeeInfo.comment.emp_id=c.emp_id,f(a.employeeInfo.comment,function(c){callbackAlert(c.status,"修改成功"),1==c.status&&a.$apply(function(){b.path("/employees")})})}}).controller("empInfo",function(a,b,c){a.sidebar=[{name:"基本信息",link:"#basic","default":1},{name:"员工评价",link:"#comment"}],c(b,function(b){console.log(b),a.employeeInfo=b;var c=API+b.info.emp_pic;a.employeeInfo.info.emp_pic=c,a.$apply()})}),angular.module("homeApp.operating").controller("employees",function(a,b,c,d,e,f,g,h){a.filter={selectSchool:{id:1,name:"全部校区"},page:1,num:num_per_page,authority:b.get("authority")};var i=getDataFromStorage("options");a.options={schools:i.schools},a.paginationConf={},d(a.filter,function(b){a.result=b.employees;var c=b.sum;a.paginationConf=h(c),a.paginationConf.onChange=function(){a.filter.page=a.paginationConf.currentPage,a.pageChange()},a.$apply()}),a.pageChange=function(){d(a.filter,function(b){a.result=b.employees,a.$apply()})},a.sendFilter=function(){a.filter.page=1,d(a.filter,function(b){console.log(b),a.result=b.employees,a.paginationConf.totalItems=b.sum,a.$apply()})},a.deleteEmp=function(a){if(confirm("确认离职？")){var b={emp_id:a};e(b,function(a){callbackAlert(a.status,"成功离职"),1==a.status&&window.location.reload()})}},a.resetPwd=function(a){if(confirm("确认重置密码？")){
var b={emp_id:a};f(b,function(a){callbackAlert(a.status,"已重置密码"),1==a.status&&window.location.reload()})}},a.addEmp=function(){g("",function(b){b.status&&(console.log(b.emp_id),a.$apply(function(){c.path("/addEmp/"+b.emp_id)}))})}}).controller("empBirth",function(a,b){b("",function(b){0==b.status?alert("最近没有人生日"):(a.birthList=b.list,a.$apply())})}),angular.module("homeApp.operating").controller("SchoolManage",function(a,b,c,d,e){a.emp_type={authority:b.get("authority")},e("",function(b){a.$apply(function(){a.result=b})}),a.addSchool=function(){return 0!=a.user.authority?(alert("没有权限"),!1):(c("",function(a){localStorage.setItem("options",JSON.stringify(a))}),void d.path("/addSchool"))},a.modifySchool=function(b){return 0!=a.user.authority?(alert("没有权限"),!1):void d.path("/modifySchool/"+b)}}).controller("AddSchool",function(a,b){a.formData={sch_name:"",sch_ads:"",sch_phone:""},a.submitData=function(){b(a.formData,function(a){window.location.href=ROOT+"schoolManage"})}}).controller("modifySchool",function(a,b,c,d){c(b,function(b){a.schInfo=b.schInfo,a.$apply()}),a.submitForm=function(){console.log(a.schInfo),a.schInfo.sch_id=b.sch_id,d(a.schInfo,function(a){1==a.status&&(window.location.href=ROOT+"schoolManage")})}}),angular.module("homeApp.student",["ngRoute","homeApp.studentService"]).config(function(a){a.when("/stuList",{templateUrl:"views/student/stuList.html",controller:"stuList"}).when("/stuInfo/:stu_id",{templateUrl:"views/student/stuInfo.html",controller:"stuInfo"}).when("/addStu/:stu_id",{templateUrl:"views/student/addStuInfo.html",controller:"addStu"}).when("/modifyStuInfo/:stu_id",{templateUrl:"views/student/modifyStu.html",controller:"modifyStuInfo"}).when("/courseList",{templateUrl:"views/student/courseList.html",controller:"courseList"}).when("/courseStuList/:course_id",{templateUrl:"views/student/courseStuList.html",controller:"courseStuList"}).when("/teachAttend/:course_id",{templateUrl:"views/student/teachAttend.html",controller:"teachAttend"}).when("/stuAttend/:course_id",{templateUrl:"views/student/stuAttend.html",controller:"stuAttend"}).when("/addCourse",{templateUrl:"views/student/addCourse.html",controller:"addCourse"}).when("/planCourse",{templateUrl:"views/student/planCourse.html",controller:"planCourse"}).when("/addStuToCourse/:course_id",{templateUrl:"views/student/stuCourse.html",controller:"addStuToCourse"}).when("/modStuCourse/:course_id/:stu_id",{templateUrl:"views/student/stuCourse.html",controller:"modStuCourse"}).when("/callback/:course_id/:stu_id",{templateUrl:"views/student/callback.html",controller:"callback"}).when("/attendList/:course_id",{templateUrl:"views/student/attendList.html",controller:"attendList"}).when("/stuBusList",{templateUrl:"views/student/stuBusList.html",controller:"stuBusList"}).when("/addStuToBus",{templateUrl:"views/student/addStuToBus.html",controller:"addStuToBus"}).when("/busStuAttendList",{templateUrl:"views/student/busStuAttendList.html",controller:"busStuAttendList"}).when("/busStuAttend/:bus_id/:date",{templateUrl:"views/student/busStuAttend.html",controller:"busStuAttend"}).when("/report/:course_id/:stu_id",{templateUrl:"views/student/report.html",controller:"report"})}),angular.module("homeApp.studentService",[]).factory("stuAPI",function(a){return{fecthStudents:a+"get_students",createStuId:a+"get_student_new_id",submitStuInfo:a+"add_student",fetchStuInfoById:a+"get_student_information",modifyStuInfo:a+"change_student_information",fetchCourseList:a+"get_courses",postCourse:a+"add_course",fetchPlanCouOp:a+"manager_course",fetchStuOfTheCou:a+"get_course_information2",fetchCourseInfo:a+"add_student_to_course",addStuToCourse:a+"add_student_to_course",fetchStuAttList:a+"get_course_attendance",fetchCourseRecord:a+"get_attendance",modifyClassInfo:a+"change_course_information",modifyStuAttend:a+"change_student_attendance",allParticipated:a+"change_student_attendance",fetchStuAttTable:a+"get_student_all_attendance",fetchCallBack:a+"get_callback",modifyCallback:a+"change_callback",fetchStuBus:a+"get_bus",modBusStuAttend:a+"change_student_bus_attendance",addStuToBus:a+"add_student_to_bus",fetchBusRecord:a+"get_bus_attendance",fetchBusRecordById:a+"get_bus_service_information",postReport:a+"get_report",submitReport:a+"change_report",deleteCourse:a+"delete_course2",deleteStuInCourse:a+"delete_course3",deleteBus:a+"delete_bus_service"}}).factory("deleteBus",function(a){return function(b,c){getData(a.deleteBus,c,b)}}).factory("postReport",function(a){return function(b,c){postData(a.postReport,b,c)}}).factory("getReport",function(a){return function(b,c){getData(a.postReport,c,b)}}).factory("submitReport",function(a){return function(b,c){postData(a.submitReport,b,c)}}).factory("createChart",function(){return function(a,b){$("#chart").highcharts({title:{text:"Chart",x:-20},xAxis:{categories:a},yAxis:{title:{text:"Score"},plotLines:[{value:0,width:1,color:"#808080"}]},tooltip:{valueSuffix:""},legend:{layout:"vertical",align:"right",verticalAlign:"middle",borderWidth:0},series:[{name:"Entrance Score",data:b.entrance},{name:"Midterm Score",data:b.midterm},{name:"End Term Score",data:b.endTerm}]})}}).factory("fecthStudents",function(a){return function(b,c){getData(a.fecthStudents,b,c)}}).factory("createStuId",function(a){return function(b){getData(a.createStuId,b)}}).factory("initStuForm",function(){var a=function(a){return{stu_basic:{stu_zh_name:"",stu_en_name:"",stu_sex:"",stu_id:a,stu_pic:{ext_name:""},stu_country:"",stu_birth:{year:moment().format("YYYY"),month:moment().format("MM"),day:moment().format("DD")},stu_ads:"",stu_grade:"",stu_study_sch:"",publics:{id:"",name:""},study_exp:"",intersts:"",character:"",expectations:""},stu_parent:{par_name:"",par_tel:"",par_email:"",par_character:""},learn_info:{stu_sch:{id:"",name:""},stu_learn_year:"",stu_learn_season:"",stu_learn_status:1}}};return{fetchData:function(b){return a(b)}}}).factory("fetchStuInfoById",function(a){return function(b,c){getData(a.fetchStuInfoById,c,b)}}).factory("modifyStuInfo",function(a){return function(b,c){postData(a.modifyStuInfo,b,c)}}).factory("fetchCourseList",function(a){return function(b,c){getData(a.fetchCourseList,c,b)}}).factory("deleteCourse",function(a){return function(b,c){getData(a.deleteCourse,c,b)}}).factory("deleteStuInCourse",function(a){return function(b,c){getData(a.deleteStuInCourse,c,b)}}).factory("fetchPlanCouOp",function(a){return function(b,c){getData(a.fetchPlanCouOp,c,b)}}).factory("planCourse",function(a){return function(b,c){postData(a.fetchPlanCouOp,b,c)}}).factory("fetchStuInfoOfTheCourse",function(a){return function(b,c){getData(a.fetchStuOfTheCou,c,b)}}).factory("fetchStuBus",function(a){return function(b,c){getData(a.fetchStuBus,c,b)}}).factory("modBusStuAttend",function(a){return function(b,c){getData(a.modBusStuAttend,c,b)}}).factory("initAddToBusForm",function(){return{stu_id:"",type:{id:"",name:""},weekdays:[{choose:!1,weekday:1,time:""},{choose:!1,weekday:2,time:""},{choose:!1,weekday:3,time:""},{choose:!1,weekday:4,time:""},{choose:!1,weekday:5,time:""},{choose:!1,weekday:6,time:""},{choose:!1,weekday:7,time:""}],year:{name:""},session:{id:"",name:""},discount_type:{id:"",name:""},bus_number:{id:"",name:""},place:"",per_price:"",sum_count:"",discount:"",pay_method:{id:"",name:""},pay_to:{id:"",name:""}}}).factory("addStuToBus",function(a){return function(b,c){postData(a.addStuToBus,b,c)}}).factory("fetchBusRecord",function(a){return function(b,c){getData(a.fetchBusRecord,c,b)}}).factory("initAddToCourseForm",function(){return function(a){return{course_id:a,stu_id:"",sum_count:"",per_price:"",discount_type:{id:"",name:""},discount:"",fee_method:{id:"",name:""},fee_to:{id:"",name:""},book_fee_method:{id:"",name:""},book_fee_to:{id:"",name:""},book_fee:"",remark:""}}}).factory("fetchCourseInfo",function(a){return function(b,c){getData(a.fetchCourseInfo,c,b)}}).factory("addStuToCourse",function(a){return function(b,c){postData(a.addStuToCourse,b,c)}}).factory("fetchCourseRecord",function(a){return function(b,c){getData(a.fetchCourseRecord,c,b)}}).factory("modifyClassInfo",function(a){return function(b,c){postData(a.modifyClassInfo,b,c)}}).factory("fetchStuAttList",function(a){return function(b,c){getData(a.fetchStuAttList,c,b)}}).factory("modifyStuAttend",function(a){return function(b,c){postData(a.modifyStuAttend,b,c)}}).factory("allParticipated",function(a){return function(b,c){getData(a.allParticipated,c,b)}}).factory("fetchStuAttTable",function(a){return function(b,c){getData(a.fetchStuAttTable,c,b)}}).factory("fetchBusRecordById",function(a){return function(b,c){getData(a.fetchBusRecordById,c,b)}}).factory("submitStuInfo",function(a){return function(b,c){$("#stuForm").ajaxSubmit({type:"post",url:a.submitStuInfo,dataType:"json",data:b,xhrFields:{withCredentials:!0},beforeSend:function(){$(".mask").show()},success:function(a){c(a)},complete:function(){$(".mask").hide()},error:function(a){alert("文件上传失败")}})}}).factory("postCourse",function(a){return function(b,c){postData(a.postCourse,b,c)}}).factory("fetchCallBack",function(a){return function(b,c){getData(a.fetchCallBack,c,b)}}).factory("modifyCallback",function(a){return function(b,c){postData(a.modifyCallback,b,c)}}).factory("initPlanForm",function(){return{course_year:"",course_session:"",course_name:{id:"",name:""},course_teacher:{id:"",name:""},weekdays:[{choose:!1,weekday:1,start_time:"",end_time:""},{choose:!1,weekday:2,start_time:"",end_time:""},{choose:!1,weekday:3,start_time:"",end_time:""},{choose:!1,weekday:4,start_time:"",end_time:""},{choose:!1,weekday:5,start_time:"",end_time:""},{choose:!1,weekday:6,start_time:"",end_time:""},{choose:!1,weekday:7,start_time:"",end_time:""}],sum_count:"",per_price:"",book_fee:""}}),angular.module("homeApp.student").controller("courseList",function(a,b,c,d){a.filter={selectSchool:{id:1,name:"全部校区"},selectSession:{id:0,name:"全部季度"},selectYear:{name:"2016"},courseType:{id:1,name:"所有课程类型"},search:""};var e=localStorage.getItem("options");e=JSON.parse(e),a.options={schools:e.schools,years:c.year,sessions:c.sessions,courseType:e.courseType},d(a.filter,function(b){console.log(b),a.courses=b,a.$apply()}),a.sendFilter=function(){d(a.filter,function(b){console.log(b),a.courses=b,a.$apply()})},a.deleteCourse=function(a){var c={course_id:a};b(c,function(a){callbackAlert(a.status,"成功删除一门课程"),window.location.reload()})}}).controller("courseStuList",function(a,b,c,d){d(b,function(b){console.log(b),a.stuCourse=b,a.$apply()}),a.deleteStu=function(a){var d={course_id:b.course_id,stu_id:a};c(d,function(a){callbackAlert(a.status,"成功删除一门课程")})}}).controller("addCourse",function(a,b,c){var d=localStorage.getItem("options");d=JSON.parse(d),a.options={schools:d.schools,courseType:d.courseType},a.course={school:{id:"",name:""},courseType:{id:"",name:""},courseName:""},a.addCourse=function(){a.course.school.id&&a.course.courseType.id&&a.course.courseName&&c(a.course,function(a){callbackAlert(a.status,"添加成功"),1==a.status&&(window.location.href=ROOT+"courseList"),b("",function(a){localStorage.setItem("courses",JSON.stringify(a))})})}}).controller("planCourse",function(a,b,c,d,e,f){var g=localStorage.getItem("courses");g=JSON.parse(g),a.options={teachers:g.teachers,courses:g.courses,years:d.year,sessions:d.session,weekdays:e},a.course=c,a.submitCourseInfo=function(){var b=a.course;if(b.course_year&&b.course_session&&b.course_name.id&&b.course_teacher.id){var c=b.weekdays;for(var d in c){var e=c[d];if(e.choose&&(!isTime(e.start_time)||!isTime(e.end_time)))return alert("请使用正确的时间格式, 12:00"),!1}f(a.course,function(a){callbackAlert(a.status,"成功排课"),1==a.status&&(window.location.href=ROOT+"courseList")})}else alert("请完成必要信息的额填写")}}).controller("addStuToCourse",function(a,b,c,d,e,f){d(b,function(b){console.log(b),a.courseInfo=b,a.$apply()}),a.formData=c(b.course_id),a.options={discount:[{id:0,name:"打折"},{id:1,name:"减价"}]};var g=localStorage.getItem("options");g=JSON.parse(g),a.options.pay_method=g.pay_method,a.getStuName=function(){var b={stu_id:a.formData.stu_id};f(b,function(b){console.log(b),a.formData.stu_name=b.stu_name,a.$apply()})},a.submitData=function(){e(a.formData,function(a){callbackAlert(a.status,"添加成功"),1==a.status&&(window.location.href=ROOT+"courseStuList/"+b.course_id)})}}).controller("callback",function(a,b,c,d){c(b,function(b){a.callback=b,a.$apply()}),a.submitCallback=function(c){var e=a.callback.callbacks[c];e.course_id=b.course_id,e.stu_id=b.stu_id,console.log(e),d(e,function(a){callbackAlert(a.status)})}}).controller("report",function(a,b,c,d,e,f){$("#header").hide(),c(b,function(b){console.log(b),a.data=b,e(b.chart_data.items,b.chart_data.score),a.$apply()}),a.submitReport=function(){console.log(a.data),a.data.stu_id=b.stu_id,a.data.course_id=b.course_id,f(a.data,function(a){1==a.status?alert("操作成功"):alert("请完善信息")})}}),angular.module("homeApp.student").controller("stuBusList",function(a,b,c,d){a.filter={selectSchool:{id:"1",name:"全部校区"},selectBus:{id:"0",name:"全部车牌"},type:{id:"1",name:"接"},selectSession:{id:0,name:"全部季度"},selectYear:{name:"2016"}};var e=getDataFromStorage("options");a.options={schools:e.schools,bus_number:e.bus_number,type:[{id:"0",name:"送"},{id:"1",name:"接"}],years:b.year,sessions:b.session},c(a.filter,function(b){a.$apply(function(){a.stuBus=b})}),a.sendFilter=function(){c(a.filter,function(b){a.$apply(function(){a.stuBus=b})})},a.deleteBus=function(a){var b={ser_id:a};d(b,function(a){callbackAlert(a.status,"删除成功")})}}).controller("addStuToBus",function(a,b,c,d,e,f,g){var h=getDataFromStorage("options");a.options={type:[{id:"0",name:"送"},{id:"1",name:"接"}],years:d.year,sessions:d.session,bus_number:h.bus_number,discount:[{id:0,name:"打折"},{id:1,name:"减价"}],pay_method:h.pay_method,weekdays:f},a.formData=g,a.getStuName=function(){var b={stu_id:a.formData.stu_id};e(b,function(b){a.formData.stu_name=b.stu_name,a.$apply()})},a.submitData=function(){var d=a.formData;if(d.bus_number.name&&d.type.name&&d.discount_type.name&&d.session.name&&d.year.name){var e=d.weekdays;for(var f in e){var g=e[f];if(g.choose&&!isTime(g.time))return alert("请使用正确的时间格式, 12:00"),!1}c(a.formData,function(a){callbackAlert(a.status),b.path("/stuBusList")})}else alert("请完善信息")}}).controller("busStuAttendList",function(a,b,c){a.filter={selectBus:{id:"0",name:"全部车牌"},date:{year:moment().format("YYYY"),month:moment().format("MM"),day:moment().format("DD")}};var d=getDataFromStorage("options");a.options={bus_number:d.bus_number,years:b},c(a.filter,function(b){a.data=b,a.$apply()}),a.sendFilter=function(){c(a.filter,function(b){a.data=b,a.$apply()})}}).controller("busStuAttend",function(a,b,c,d){a.attendType=[{id:"1",name:"是"},{id:"0",name:"否"}],a.filter={bus:{id:b.bus_id},date:b.date,type:{id:-1,name:"接或送"}},a.options={type:[{id:-1,name:"接或送"},{id:"0",name:"送"},{id:"1",name:"接"}]},c(a.filter,function(b){a.busAttend=b,a.$apply()}),a.modify=function(b){var c=a.busAttend.list[b],e=c.isEditing;if(e){var f={ser_id:{id:c.ser_id},state:c.attend_state};d(f,function(a){callbackAlert(a.status,"考勤成功")})}a.busAttend.list[b].isEditing=!e},a.sendFilter=function(){c(a.filter,function(b){a.busAttend=b,a.$apply()})}}),angular.module("homeApp.student").controller("stuList",function(a,b,c,d,e){a.filter={selectSchool:{id:1,name:"全部校区"},page:1,num:num_per_page},a.paginationConf={},c(function(b){console.log(b),a.$apply(function(){a.students=b.result;var c=b.sum;a.paginationConf=e(c),a.paginationConf.onChange=function(){a.filter.page=a.paginationConf.currentPage,a.pageChange()}})},a.filter);var f=getDataFromStorage("options");a.options={options:f.schools},a.pageChange=function(){c(function(b){a.students=b.result,a.$apply()},a.filter)},a.sendFilter=function(){a.filter.page=1,c(function(b){console.log(b),a.students=b.result,a.paginationConf.totalItems=b.sum,a.$apply()},a.filter)},a.addStu=function(){d(function(c){1==c.status&&a.$apply(function(){b.path("/addStu/"+c.stu_id)})})}}).controller("stuInfo",function(a,b,c,d){a.sidebar=[{name:"基本信息",link:"#basic","default":1},{name:"家长信息",link:"#parent"},{name:"学习信息",link:"#learn"},{name:"服务信息",link:"#service"},{name:"学费信息",link:"#fee"}],d(c,function(b){a.stuInfo=b;var c=a.stuInfo.stu_basic.stu_pic;a.stuInfo.stu_basic.stu_pic=API+c,console.log(b),a.$apply()}),a.pay=function(a,d,e){return!e&&void b.path("/addIncome").search({s_id:a,co:d,stu:c.stu_id})}}).controller("addStu",function(a,b,c,d,e,f,g,h){a.sidebar=[{name:"基本信息",link:"#basic","default":1},{name:"家长信息",link:"#parent"},{name:"学习信息",link:"#learn"}];var i=getDataFromStorage("options");a.options={schools:i.schools,publics:i.publics,sessions:e.session,years:e.year,learningStatus:[{id:"1",name:"报名"},{id:"2",name:"试听"},{id:"3",name:"入学"},{id:"4",name:"暂停"},{id:"5",name:"退学"}]},a.stuInfo=d.fetchData(b.stu_id),f(function(b){a.stuInfo.stu_basic.stu_pic.ext_name=b,a.$apply()}),a.submitStuInfo=function(b){b?(console.log(a.stuInfo),g(a.stuInfo,function(b){callbackAlert(b.status,"添加成功"),1==b.status?a.$apply(function(){c.path("/courseList")}):alert("出现错误，稍后重试")})):alert("请检查是否有必须项未填")}}).controller("modifyStuInfo",function(a,b,c,d,e,f,g){a.sidebar=[{name:"基本信息",link:"#basic","default":1},{name:"家长信息",link:"#parent"},{name:"学习信息",link:"#learn"}];var h=getDataFromStorage("options");a.options={schools:h.schools,publics:h.publics,sessions:f.session,years:f.year,learningStatus:[{id:"1",name:"报名"},{id:"2",name:"试听"},{id:"3",name:"入学"},{id:"4",name:"暂停"},{id:"5",name:"退学"}]},e(d,function(b){console.log(b),a.stuInfo=b;var c=a.stuInfo.stu_basic.stu_pic;a.stuInfo.stu_basic.stu_pic=API+c,a.$apply()}),a.submitStuInfo=function(){g(a.stuInfo,function(a){callbackAlert(a.status,"修改成功"),1==a.status&&(window.location.href=ROOT+"stuList")})},a.pay=function(a,b,e){return!e&&void c.path("/addIncome").search({s_id:a,co:b,stu:d.stu_id})}}),angular.module("homeApp.educate",["ngRoute","homeApp.educateService"]).config(function(a){a.when("/eduCourseList",{templateUrl:"views/educate/eduCourseList.html",controller:"eduCourseList"}).when("/eduStuList/:course_id",{templateUrl:"views/educate/eduStuList.html",controller:"eduStuList"}).when("/todayClass/:course_id",{templateUrl:"views/educate/todayClass.html",controller:"todayClass"}).when("/stuAttendList/:course_id",{templateUrl:"views/educate/stuAttendList.html",controller:"stuAttendList"}).when("/teaStuAttend/:course_id",{templateUrl:"views/educate/teaStuAttend.html",controller:"teaStuAttend"}).when("/teaStuInfo/:stu_id",{templateUrl:"views/educate/teaStuInfo.html",controller:"teaStuInfo"}).when("/homework/:course_id",{templateUrl:"views/educate/homework.html",controller:"homework"}).when("/teaCallback/:course_id/:stu_id",{templateUrl:"views/educate/callback.html",controller:"teaCallback"}).when("/teaReport/:course_id/:stu_id",{templateUrl:"views/educate/teaReport.html",controller:"teaReport"})}),angular.module("homeApp.educateService",[]).factory("eduAPI",function(a){return{fecthAllCourse:a+"get_course",fetchCourseStu:a+"get_student",fetchStuInfoById:a+"get_student_information",fetchTodayClass:a+"get_course_information",fetchHomeworks:a+"get_student_homework_state",fetchStuAttend:a+"get_student_attendance",modifyStuAttend:a+"change_student_attendance",allAttend:a+"change_student_attendance",fetchTeaCallBack:a+"get_callback2",postCallback:a+"add_callback",modifyCallback:a+"change_callback2",postClassRecord:a+"change_course_record",modHomework:a+"change_student_homework_state"}}).factory("modHomework",function(a){return function(b,c){postData(a.modHomework,b,c)}}).factory("postClassRecord",function(a){return function(b,c){postData(a.postClassRecord,b,c)}}).factory("fetchTeaCallBack",function(a){return function(b,c){getData(a.fetchTeaCallBack,c,b)}}).factory("postCallback",function(a){return function(b,c){postData(a.postCallback,b,c)}}).factory("modifyCallback",function(a){return function(b,c){postData(a.modifyCallback,b,c)}}).factory("fecthAllCourse",function(a){return function(b,c){getData(a.fecthAllCourse,c,b)}}).factory("fetchCourseStu",function(a){return function(b,c){getData(a.fetchCourseStu,c,b)}}).factory("fetchTodayClass",function(a){return function(b,c){getData(a.fetchTodayClass,c,b)}}).factory("fetchStuInfoById",function(a){return function(b,c){getData(a.fetchStuInfoById,c,b)}}).factory("fetchHomeworks",function(a){return function(b,c){getData(a.fetchHomeworks,c,b)}}).factory("fetchStuAttend",function(a){return function(b,c){getData(a.fetchStuAttend,c,b)}}).factory("modifyStuAttend",function(a){return function(b,c){getData(a.modifyStuAttend,c,b)}}).factory("allAttend",function(a){return function(b,c){getData(a.allAttend,c,b)}}),angular.module("homeApp.educate").controller("eduCourseList",function(a,b){b("",function(b){a.$apply(function(){a.courseList=b})})}).controller("eduStuList",function(a,b,c){c(b,function(b){a.$apply(function(){a.data=b})})}).controller("todayClass",function(a,b,c,d){c(b,function(b){a.$apply(function(){a.data=b})}),a.modify=function(b){var c=a.data.classes[b],e=c.isEditing;if(e){var f={course_id:c.id,att_id:c.id,note:c.note};d(f,function(a){1==a.status&&alert("提交成功")}),console.log(a.data.classes[b].note)}a.data.classes[b].isEditing=!e}}).controller("teaCallback",function(a,b,c,d,e){c(b,function(b){a.callback=b,a.$apply()}),a.postData={course_id:b.course_id,stu_id:b.stu_id,new_callback:""},a.submitCallback=function(){d(a.postData,function(a){callbackAlert(a.status,"submit successfully")})},a.modify=function(c){var d=a.callback.callbacks[c];d.course_id=b.course_id,d.stu_id=b.stu_id,e(d,function(a){callbackAlert(a.status,"modify successfully")})}}).controller("teaReport",function(a,b,c,d,e,f){$("#header").hide(),c(b,function(b){a.data=b,e(b.chart_data.items,b.chart_data.score),a.$apply()}),a.submitReport=function(){console.log(a.data),a.data.stu_id=b.stu_id,a.data.course_id=b.course_id,f(a.data,function(a){callbackAlert(a.status)})}}),angular.module("homeApp.educate").controller("teaStuInfo",function(a,b,c){a.sidebar=[{name:"基本信息",link:"#basic","default":1},{name:"家长信息",link:"#parent"}],c(b,function(b){console.log(b),a.$apply(function(){a.stuInfo=b})})}),angular.module("homeApp.analysis",["ngRoute","homeApp.analysisService"]).config(function(a){a.when("/teaSalary",{templateUrl:"views/analysis/teaSalary.html",controller:"teaSalary"}).when("/schInfo",{templateUrl:"views/analysis/schInfo.html",controller:"schInfo"}).when("/stuFeeIncome/:course_id/:type_id",{templateUrl:"views/analysis/stuFeeIncome.html",controller:"stuFeeIncome"}).when("/schFeeIncome",{templateUrl:"views/analysis/schFeeIncome.html",controller:"schFeeIncome"}).when("/stuBookIncome/:course_id/:type_id",{templateUrl:"views/analysis/stuBookIncome.html",controller:"stuBookIncome"}).when("/schBookIncome",{templateUrl:"views/analysis/schBookIncome.html",controller:"schBookIncome"}).when("/stuBusIncome",{templateUrl:"views/analysis/stuBusIncome.html",controller:"stuBusIncome"}).when("/schBusIncome",{templateUrl:"views/analysis/schBusIncome.html",controller:"schBusIncome"})}),angular.module("homeApp.analysisService",[]).factory("analysisAPI",function(a){return{fetchTeaSalary:a+"get_teacher_salary",fetchStuFee:a+"get_course_income",fetchSchFee:a+"get_course_income2",fetchStuBookFee:a+"get_book_income",fetchSchBookFee:a+"get_book_income2",fetchStuBusFee:a+"get_bus_income",fetchSchBusFee:a+"get_bus_income2",fetchSchInfo:a+"session_analysis"}}).factory("fetchTeaSalary",function(a){return function(b,c){getData(a.fetchTeaSalary,c,b)}}).factory("fetchStuFee",function(a){return function(b,c){getData(a.fetchStuFee,c,b)}}).factory("fetchSchFee",function(a){return function(b,c){getData(a.fetchSchFee,c,b)}}).factory("fetchStuBookFee",function(a){return function(b,c){getData(a.fetchStuBookFee,c,b)}}).factory("fetchSchBookFee",function(a){return function(b,c){getData(a.fetchSchBookFee,c,b)}}).factory("fetchStuBusFee",function(a){return function(b,c){getData(a.fetchStuBusFee,c,b)}}).factory("fetchSchBusFee",function(a){return function(b,c){getData(a.fetchSchBusFee,c,b)}}).factory("fetchSchInfo",function(a){return function(b,c){getData(a.fetchSchInfo,c,b)}}),angular.module("homeApp.analysis").controller("teaSalary",function(a,b,c){a.filter={selectSchool:{id:"1",name:"全部校区"},type:{id:0,name:"全部教师"},startTime:{name:moment().add("-1","months").format("YYYY-MM")},endTime:{name:moment().format("YYYY-MM")}},b(a.filter,function(b){a.$apply(function(){a.data=b})});var d=getDataFromStorage("options");a.options={schools:d.schools,yearMonth:c,type:[{id:1,name:"全职老师"},{id:2,name:"兼职老师"}]},a.sendFilter=function(){console.log(a.filter),b(a.filter,function(b){a.$apply(function(){a.data=b})})}}).controller("stuFeeIncome",function(a,b,c,d,e,f){console.log(c),a.filter={selectSchool:{id:1,name:"全部校区"},year:{name:moment().format("YYYY")},session:{id:1,name:"春季班"},startTime:{name:moment().add("-1","months").format("YYYY-MM")},endTime:{name:moment().format("YYYY-MM")},courseType:{id:c.type_id,name:b.search().c_t},course:{id:c.course_id,name:b.search().c_n}},d(a.filter,function(b){a.$apply(function(){a.data=b})});var g=getDataFromStorage("options");a.options={schools:g.schools,year:f.year,session:f.session,yearMonth:e,courseType:g.linkCourse},a.sendFilter=function(){console.log(a.filter),d(a.filter,function(b){a.$apply(function(){a.data=b})})}}).controller("schFeeIncome",function(a,b,c,d,e){a.filter={selectSchool:{id:1,name:"全部校区"},year:{name:moment().format("YYYY")},session:{id:1,name:"春季班"},startTime:{name:moment().add("-1","months").format("YYYY-MM")},endTime:{name:moment().format("YYYY-MM")},courseType:{id:"",name:"课程类型"},course:{id:"",name:""}},c(a.filter,function(b){a.$apply(function(){a.data=b})});var f=getDataFromStorage("options");a.options={schools:f.schools,year:e.year,session:e.session,yearMonth:d,courseType:f.linkCourse},a.skipToStuCourse=function(a,c,d,e){b.path("/stuFeeIncome/"+c+"/"+a).search({c_n:d,c_t:e})},a.sendFilter=function(){console.log(a.filter),c(a.filter,function(b){a.$apply(function(){a.data=b})})}}).controller("stuBookIncome",function(a,b,c,d,e,f){a.filter={selectSchool:{id:1,name:"全部校区"},year:{name:moment().format("YYYY")},session:{id:1,name:"春季班"},startTime:{name:moment().add("-1","months").format("YYYY-MM")},endTime:{name:moment().format("YYYY-MM")},courseType:{id:"",name:"课程类型"},courseType:{id:b.type_id,name:c.search().c_t},course:{id:b.course_id,name:c.search().c_n}},d(a.filter,function(b){console.log(b),a.$apply(function(){a.data=b})});var g=getDataFromStorage("options");a.options={schools:g.schools,year:f.year,session:f.session,yearMonth:e,courseType:g.linkCourse},a.sendFilter=function(){console.log(a.filter),d(a.filter,function(b){a.$apply(function(){a.data=b})})}}).controller("schBookIncome",function(a,b,c,d,e){a.filter={selectSchool:{id:1,name:"全部校区"},year:{name:moment().format("YYYY")},session:{id:1,name:"春季班"},startTime:{name:moment().add("-1","months").format("YYYY-MM")},endTime:{name:moment().format("YYYY-MM")},courseType:{id:"",name:"课程类型"},course:{id:"",name:""}},c(a.filter,function(b){a.$apply(function(){a.data=b})});var f=getDataFromStorage("options");a.options={schools:f.schools,year:e.year,session:e.session,yearMonth:d,courseType:f.linkCourse},a.sendFilter=function(){console.log(a.filter),c(a.filter,function(b){a.$apply(function(){a.data=b})})},a.skipToStuBook=function(a,c,d,e){b.path("/stuBookIncome/"+c+"/"+a).search({c_n:d,c_t:e})}}).controller("stuBusIncome",function(a,b,c,d,e){a.filter={school:{id:1,name:"全部校区"},startTime:{name:moment().add("-1","months").format("YYYY-MM")},endTime:{name:moment().format("YYYY-MM")},year:{name:moment().format("YYYY")},busNumber:{id:0,name:"全部车牌"}},b(a.filter,function(b){a.$apply(function(){a.data=b})});var f=getDataFromStorage("options");a.options={schools:f.schools,year:c.year,yearMonth:d,busNumber:f.bus_number},a.sendFilter=function(){b(a.filter,function(b){a.$apply(function(){a.data=b})})}}).controller("schBusIncome",function(a,b,c,d){a.filter={school:{id:1,name:"全部校区"},startTime:{name:moment().add("-1","months").format("YYYY-MM")},endTime:{name:moment().format("YYYY-MM")},year:{name:moment().format("YYYY")},busNumber:{id:0,name:"全部车牌"}},b(a.filter,function(b){a.$apply(function(){a.data=b})});var e=getDataFromStorage("options");a.options={schools:e.schools,year:d,yearMonth:c,busNumber:e.bus_number},a.sendFilter=function(){b(a.filter,function(b){a.$apply(function(){a.data=b})})}}).controller("schInfo",function(a,b,c){a.filter={school:{id:1,name:"全部校区"},year:{name:moment().format("YYYY")},session:{id:"1",name:"春季班"}},b(a.filter,function(b){a.data=b,a.$apply()});var d=getDataFromStorage("options");a.options={schools:d.schools,year:c.year,session:c.sessions},a.sendFilter=function(){b(a.filter,function(a){console.log(a)})}}),angular.module("homeApp.finance",["ngRoute","homeApp.financeService"]).config(function(a){a.when("/payList",{templateUrl:"views/finance/payList.html",controller:"payList"}).when("/appList",{templateUrl:"views/finance/appList.html",controller:"appList"}).when("/incomeList",{templateUrl:"views/finance/income.html",controller:"incomeList"}).when("/addPay",{templateUrl:"views/finance/payForm.html",controller:"addPay"}).when("/modPay/:pay_id",{templateUrl:"views/finance/payForm.html",controller:"modPay"}).when("/modIncome/:in_id",{templateUrl:"views/finance/incomeForm.html",controller:"modIncome"}).when("/addIncome",{templateUrl:"views/finance/incomeForm.html",controller:"addIncome"}).when("/payForApp/:app_id",{templateUrl:"views/finance/applicate.html",controller:"payForApp"}).when("/daily",{templateUrl:"views/finance/daily.html",controller:"daily"}).when("/account",{templateUrl:"views/finance/account.html",controller:"account"}).when("/checkApp/:app_id",{templateUrl:"views/finance/application.html",controller:"checkApp"})}).controller("daily",function(a,b,c){a.options={date:c},a.filter={date:{name:moment().format("YYYY-MM-DD")}},a.cur_time={date:moment().format("YYYY-MM-DD")},b("",function(b){a.daily=b,a.$apply()}),a.sendFilter=function(){b(a.filter,function(b){a.daily=b,a.$apply()})}}).controller("account",function(a,b,c){a.options={method:[{id:0,name:"现金"},{id:1,name:"刷卡"}]},a.filter={method:{id:0,name:"现金"}},b(a.filter,function(b){console.log(b),a.account=b,a.$apply()}),a.modify=function(b){var d=a.account.list,e=d[b].isEditing;e&&c(d[b],function(a){a.status&&alert("修改成功")}),a.account.list[b].isEditing=!e},a.sendFilter=function(){b(a.filter,function(b){a.account=b,a.$apply()})}}),angular.module("homeApp.financeService",[]).factory("financeAPI",function(a){return{fetchPayList:a+"get_cost",addPay:a+"add_cost",fetchIncomeList:a+"get_income",addIncome:a+"add_income",fetchAppList:a+"get_application2",payForApp:a+"accept_application",fetchAppById:a+"get_application_information",payForApp:a+"accept_application",modPay:a+"change_cost",modifyAccount:a+"change_balance",fetchAccounts:a+"get_balance",daily:a+"get_cost_income",modIncome:a+"change_income",deleteIncome:a+"delete_income"}}).factory("deleteIncome",function(a){return function(b,c){getData(a.deleteIncome,c,b)}}).factory("fetchDaily",function(a){return function(b,c){getData(a.daily,c,b)}}).factory("fetchAccounts",function(a){return function(b,c){getData(a.fetchAccounts,c,b)}}).factory("fetchPayList",function(a){return function(b,c){getData(a.fetchPayList,c,b)}}).factory("initAddPayForm",function(){return{school:{id:"",name:""},pay_date:moment().format("YYYY-MM-DD"),pay_type:{id:"",name:""},pay_sec_type:{id:"",name:""},pay_method:{id:"",name:""},pay_to:{id:"",name:""},cost:"",app_state:0,abstraction:""}}).factory("addPay",function(a){return function(b,c){postData(a.addPay,b,c)}}).factory("fetchPayById",function(a){return function(b,c){getData(a.modPay,c,b)}}).factory("modPay",function(a){return function(b,c){postData(a.modPay,b,c)}}).factory("fetchIncomeList",function(a){return function(b,c){getData(a.fetchIncomeList,c,b)}}).factory("initAddIncomeForm",function(a,b){return function(a,c,d,e){return{school:{id:"",name:""},other_data:{course:{id:c,name:""},bus:{id:c,name:""},stu_id:d},in_date:moment().format("YYYY-MM-DD"),type:{id:"",name:""},pay_method:{id:"",name:""},pay_to:{id:"",
name:""},sum:a,abstraction:"",charge_name:b.get("user_name"),receipt_no:""}}}).factory("addIncome",function(a){return function(b,c){postData(a.addIncome,b,c)}}).factory("fetchIncomeById",function(a){return function(b,c){getData(a.modIncome,c,b)}}).factory("fetchAppList",function(a){return function(b,c){getData(a.fetchAppList,c,b)}}).factory("payForApp",function(a){return function(b,c){postData(a.payForApp,b,c)}}).factory("fetchAppById",function(a){return function(b,c){getData(a.fetchAppById,c,b)}}).factory("modifyAccount",function(a){return function(b,c){postData(a.modifyAccount,b,c)}}),angular.module("homeApp.finance").controller("appList",function(a,b,c,d){a.filter={selectSchool:{id:"1",name:"全部校区"},startTime:{name:moment().add("-1","months").format("YYYY-MM")},endTime:{name:moment().format("YYYY-MM")},type:{id:0,name:"未付款"},page:1,num:num_per_page},a.paginationConf={},c(a.filter,function(b){console.log(b),a.$apply(function(){a.app=b.result;var c=b.total.number;a.paginationConf=d(c),a.paginationConf.onChange=function(){a.filter.page=a.paginationConf.currentPage,a.pageChange()}})}),a.pageChange=function(){c(a.filter,function(b){a.$apply(function(){a.app=b.result})})};var e=getDataFromStorage("options");a.options={schools:e.schools,type:[{id:0,name:"未付款"},{id:1,name:"已付款"}],yearMonth:b},a.sendFilter=function(){a.filter.page=1,console.log(a.filter),c(a.filter,function(b){a.$apply(function(){a.paginationConf.totalItems=b.total.num,a.app=b.result})})}}).controller("payForApp",function(a,b,c,d,e){a.autoData={pay_date:moment().format("YYYY-MM-DD")},d(c,function(b){console.log(b),a.$apply(function(){a.appForm=b})}),a.postData={app_id:c.app_id,type:{payFisrt:{id:"",name:""},paySec:{id:"",name:""}},method:{payMethod:{id:"",name:""},payTo:{id:"",name:""}}};var f=getDataFromStorage("options");a.options={pay_method:f.pay_method,pay_type:f.pay_type},a.payForApp=function(){console.log(a.postData),e(a.postData,function(a){callbackAlert(a.status,"成功付款"),b.path("/appList")})}}).controller("checkApp",function(a,b,c){c(b,function(b){console.log(b),a.$apply(function(){a.appForm=b})})}),angular.module("homeApp.finance").controller("incomeList",function(a,b,c,d,e,f){a.emp_type={type:b.get("type")},a.filter={selectSchool:{id:"1",name:"全部校区"},startTime:{name:moment().add("-1","months").format("YYYY-MM")},endTime:{name:moment().format("YYYY-MM")},payMethod:{id:"",name:"支付方式"},payTo:{id:"",name:""},type:{id:0,name:"全部类型"},page:1,num:num_per_page},a.paginationConf={},d(a.filter,function(b){console.log(b),a.$apply(function(){a.incomeList=b;var c=b.total.number;a.paginationConf=e(c),a.paginationConf.onChange=function(){a.filter.page=a.paginationConf.currentPage,a.pageChange()}})});var g=getDataFromStorage("options");a.options={yearMonth:c,schools:g.schools,pay_method:g.pay_method,type:[{id:0,name:"全部类型"},{id:1,name:"学费"},{id:2,name:"书费"},{id:3,name:"校车费"},{id:4,name:"其他"}]},a.pageChange=function(){d(a.filter,function(b){a.$apply(function(){a.incomeList=b})})},a.sendFilter=function(){a.filter.page=1,d(a.filter,function(b){a.$apply(function(){a.incomeList=b,a.paginationConf.totalItems=b.sum})})},a.deleteIncome=function(a){var b={in_id:a};f(b,function(a){callbackAlert(a.status,"删除成功")})}}).controller("addIncome",function(a,b,c,d,e,f){var g=b.search(),h=g.co,i=g.s_id,j=g.stu;a.formData=c(h,i,j);var k=getDataFromStorage("options");a.options={schools:k.schools,bus_number:k.bus_number,course:k.course,pay_method:k.pay_method,type:[{id:1,name:"学费"},{id:2,name:"书费"},{id:3,name:"校车费"},{id:4,name:"其他"}],date:e},a.showStu={bus:1,course:1},a.incomeType=function(){if(!j){var b=a.formData.type.id;1==b||2==b?(a.showStu.bus=1,a.showStu.course=0,console.log(a.showStu)):3==b?(a.showStu.course=1,a.showStu.bus=0,console.log(a.showStu)):(a.showStu.course=1,a.showStu.bus=1)}},a.downClick=function(){var b={stu_id:a.formData.other_data.stu_id};f(b,function(b){a.options.course=b,a.$apply()})},a.addIncome=function(){console.log(a.formData),d(a.formData,function(a){callbackAlert(a.status,"成功添加收入")})}}),angular.module("homeApp.finance").controller("payList",function(a,b,c,d,e){a.emp_type={type:b.get("type")},a.filter={selectSchool:{id:"1",name:"全部校区"},startTime:{name:moment().add("-1","months").format("YYYY-MM")},endTime:{name:moment().format("YYYY-MM")},payFisrt:{id:"",name:"费用类型"},paySec:{id:"",name:""},payMethod:{id:"",name:"支付方式"},payTo:{id:"",name:""},page:1,num:num_per_page},a.paginationConf={},d(a.filter,function(b){console.log(b),a.$apply(function(){a.payList=b;var c=b.total.number;a.paginationConf=e(c),a.paginationConf.onChange=function(){a.filter.page=a.paginationConf.currentPage,a.pageChange()}})});var f=getDataFromStorage("options");a.options={yearMonth:c,schools:f.schools,pay_method:f.pay_method,pay_type:f.pay_type},a.pageChange=function(){d(a.filter,function(b){a.$apply(function(){a.payList=b})})},a.sendFilter=function(){a.filter.page=1,d(a.filter,function(b){a.$apply(function(){a.payList=b,a.paginationConf.totalItems=b.sum})})}}).controller("modPay",function(a,b,c,d){var e=getDataFromStorage("options");a.options={schools:e.schools,pay_type:e.pay_type,pay_method:e.pay_method},c(b,function(b){a.$apply(function(){a.formData=b})}),a.addPay=function(){d(a.formData,function(a){callbackAlert(a.status,"修改成功"),1==a.status&&(window.location.href=ROOT+"payList")})}}).controller("addPay",function(a,b,c,d,e){a.formData=c;var f=getDataFromStorage("options");a.options={schools:f.schools,pay_method:f.pay_method,pay_type:f.pay_type,date:e},a.addPay=function(){d(a.formData,function(a){callbackAlert(a.status,"成功添加支出"),1==a.status&&(window.location.href=ROOT+"payList")})}});